<!DOCTYPE html>
<html>
<head>
<link href="sp.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="swy37.css">
</head>
<body>
<button id="floating-filter-btn" onclick="openModal()"> <span style="font-size: 24px;">üîç</span> </button>
<div id="filter-modal" class="modal-overlay">
  <div class="modal-window">
    <div class="modal-header"> <strong>Filter</strong>
      <button class="close-btn" onclick="closeModal()">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="filter-row">
        <div class="filter-label">Status</div>
        <div class="filter-group">
          <button class="btn active" onclick="filterClick(this, 'st', 'all')">ALL</button>
          <button class="btn" onclick="filterClick(this, 'st', 'NL|SNL')">NL/SNL</button>
          <button class="btn" onclick="filterClick(this, 'st', 'YL|AYL')">YL/AYL</button>
          <button class="btn" onclick="filterClick(this, 'st', 'PY')">PY</button>
        </div>
      </div>
      <div class="filter-row">
        <div class="filter-label">CD</div>
        <div class="filter-group">
          <button class="btn active" onclick="filterClick(this, 'cd', 'all')">ALL</button>
          <button class="btn" onclick="filterClick(this, 'cd', 'CD-1')">1</button>
          <button class="btn" onclick="filterClick(this, 'cd', 'CD-2')">2</button>
          <button class="btn" onclick="filterClick(this, 'cd', 'CD-3')">3</button>
          <button class="btn" onclick="filterClick(this, 'cd', 'CD-4')">4</button>
          <button class="btn" onclick="filterClick(this, 'cd', 'CD-5')">5</button>
          <button class="btn" onclick="filterClick(this, 'cd', 'CD-6')">6</button>
          <button class="btn" onclick="filterClick(this, 'cd', 'CD-7')">7</button>
          <button class="btn" onclick="filterClick(this, 'cd', 'CD-8')">8</button>
        </div>
      </div>
      <div class="filter-row">
        <div class="filter-label">LG</div>
        <div class="filter-group">
          <button class="btn active" onclick="filterClick(this, 'lg', 'all')">ALL</button>
          <button class="btn" onclick="filterClick(this, 'lg', 'LG-A')">A</button>
          <button class="btn" onclick="filterClick(this, 'lg', 'LG-B')">B</button>
          <button class="btn" onclick="filterClick(this, 'lg', 'LG-C')">C</button>
          <button class="btn" onclick="filterClick(this, 'lg', 'LG-D')">D</button>
          <button class="btn" onclick="filterClick(this, 'lg', 'LG-E')">E</button>
          <button class="btn" onclick="filterClick(this, 'lg', 'LG-F')">F</button>
          <button class="btn" onclick="filterClick(this, 'lg', 'LG-G')">G</button>
          <button class="btn" onclick="filterClick(this, 'lg', 'LG-H')">H</button>
          <button class="btn" onclick="filterClick(this, 'lg', 'LG-I')">I</button>
          <button class="btn" onclick="filterClick(this, 'lg', 'LG-J')">J</button>
          <button class="btn" onclick="filterClick(this, 'lg', 'LG-K')">K</button>
          <button class="btn" onclick="filterClick(this, 'lg', 'LG-L')">L</button>
          <button class="btn" onclick="filterClick(this, 'lg', 'LG-M')">M</button>
          <button class="btn" onclick="filterClick(this, 'lg', 'LG-N')">N</button>
        </div>
      </div>
      <div class="filter-row">
        <div class="filter-label">committee</div>
        <div class="filter-group">
          <button class="btn active" onclick="filterClick(this, 'committee', 'all')">ALL</button>
          <button class="btn" onclick="filterClick(this, 'committee', 'Discussion')">Discussion</button>
          <button class="btn" onclick="filterClick(this, 'committee', 'National Presentation')">NP</button>
          <button class="btn" onclick="filterClick(this, 'committee', 'Peer-Learning Seminar')">PL</button>
          <button class="btn" onclick="filterClick(this, 'committee', 'Club Activity')">Club</button>
          <button class="btn" onclick="filterClick(this, 'committee', 'Event')">Event</button>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="apply-btn" onclick="closeModal()">Apply</button>
    </div>
  </div>
</div>
<div class="member-grid" id="container">Loading...</div>
<script>
const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQcMuUxWF_fUMNpX8uXHMs-mTA1uuOrPiVjgQYJyh-KRpQyms_FbN9dsnMYlPwSDQJrOcUlzVkn48Mh/pub?gid=331668856&single=true&output=csv';

let activeFilters = { committee: 'all', cd: 'all', lg: 'all', st:'all'};

async function fetchMembers() {
  try {
    const response = await fetch(csvUrl);
    const text = await response.text();
    const rows = text.split('\n').slice(1);
    const container = document.getElementById('container');
    container.innerHTML = '';

    rows.forEach(row => {
      const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
      if (cols.length < 12) return;

    let rawPhotoUrl = cols[11]?.replace(/"/g, '').trim() || '';
    let finalPhotoUrl = '';

    if (rawPhotoUrl.includes('drive.google.com')) {
        const fileId = rawPhotoUrl.match(/\/d\/([a-zA-Z0-9_-]+)/)?.[1];
        if (fileId) {
            // thumbnail ÂΩ¢Âºè + „Çµ„Ç§„Ç∫ÊåáÂÆö„ÄÇ„Åì„Çå„ÅåÁèæÂú®ÊúÄ„ÇÇ403„ÇíÂõûÈÅø„Åó„ÇÑ„Åô„ÅÑÂΩ¢Âºè„Åß„Åô
            finalPhotoUrl = `https://lh3.googleusercontent.com/u/0/d/${fileId}=w400-h400-p`;
        }
    }

      const d = {
        del: cols[2]?.replace(/"/g, '').trim() || '',
        st:  cols[3]?.replace(/"/g, '').trim() || '',
        id:  cols[4]?.replace(/"/g, '').trim() || '',
        cd:  cols[5]?.replace(/"/g, '').trim() || '',
        lg:  cols[6]?.replace(/"/g, '').trim() || '',
        com: cols[7]?.replace(/"/g, '').trim() || '',
        name:cols[8]?.replace(/"/g, '').trim() || '',
        nick:cols[9]?.replace(/"/g, '').trim() || '',
        ins: cols[10]?.replace(/"/g, '').trim() || '',
        img: cols[11]?.replace(/"/g, '').trim() || ''
      };

      const card = document.createElement('div');
      card.className = 'card';
      // Ê§úÁ¥¢Áî®„Éá„Éº„Çø
      card.dataset.committee = d.com;
      card.dataset.cd = d.cd;
      card.dataset.lg = d.lg;
	  card.dataset.st = d.st;
      
      card.innerHTML = `
        <div class="card-header"><div class="del"><div class="del bg-${d.del}">${d.del}</div></div><img src="${d.img || 'https://api.dicebear.com/7.x/initials/svg?seed=' + d.name}"><span class="nickname">${d.nick}</span><span class="name">${d.name}</span></div><div class="card-body"><div class="info-row"><span>Status</span><span class="val">${d.st}</span></div><div class="info-row"><span>CD</span><span class="val">${d.cd}</span></div><div class="info-row"><span>LG</span><span class="val">${d.lg}</span></div><div class="info-row"><span>Committee</span><span class="val">${d.com}</span></div></div>${d.ins ? `<div class="card-footer"><a href="${d.ins}" target="_blank" class="insta-link">Instagram</a></div>` : ''}`;
      container.appendChild(card);
    });
  } catch (e) { console.error(e);}
}

function filterClick(btn, type, val) {
  // 1. „Éú„Çø„É≥„ÅÆË¶ã„ÅüÁõÆ„ÇíÂàá„ÇäÊõø„Åà„Çã
  const row = btn.closest('.filter-group');
  row.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');

  // 2. „Éï„Ç£„É´„Çø„ÉºÁä∂ÊÖã„Çí‰øùÂ≠ò
  activeFilters[type] = val;

  // 3. ÂÖ®„Ç´„Éº„Éâ„Å´ÂØæ„Åó„Å¶Âà§ÂÆö„ÇíË°å„ÅÜ
  const cards = document.querySelectorAll('.card');
  cards.forEach(card => {
		  const checkMatch = (filterVal, cardVal) => {
      if (filterVal === 'all') return true;
      const targets = filterVal.split('|'); // 'NL|SNL' „Çí ['NL', 'SNL'] „Å´ÂàÜ„Åë„Çã
      return targets.includes(cardVal);     // „Ç´„Éº„Éâ„ÅÆÂÄ§„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    };
		  
    const mCom = checkMatch(activeFilters.committee, card.dataset.committee);
    const mCd  = checkMatch(activeFilters.cd, card.dataset.cd);
    const mLg  = checkMatch(activeFilters.lg, card.dataset.lg);
    const mSt  = checkMatch(activeFilters.st, card.dataset.st);

    if (mCom && mCd && mLg && mSt) {
      card.classList.remove('hide');
    } else {
      card.classList.add('hide');
    }
  });
}

fetchMembers();
		  
function openModal() {
  document.getElementById('filter-modal').style.display = 'flex';
  document.body.classList.add('modal-open');
}

function closeModal() {
  document.getElementById('filter-modal').style.display = 'none';
  document.body.classList.remove('modal-open');
}
</script>
</body>
</html>